# Inherit/include base functionality
inherit kernel
require linux-machine-common.inc

# returns all the elements from the src uri that are .cfg files
def find_config_fragments(d):
    sources=src_patches(d, True)
    sources_list=[]
    for s in sources:
        if s.endswith('.cfg'):
            sources_list.append(s)
    return sources_list

kernel_do_configure_prepend() {
	# Find all ".cfg" files and cat them together into a .config
	CFG_FILES="${@" ".join(find_config_fragments(d))}"
	if [ ! -z "$CFG_FILES" ]; then
		echo "# Generated by linux-xlnx recipe in meta-xilinx" > "${B}/.config"
		for i in $CFG_FILES; do
			echo "Joining configuration file $i"
			echo "# $i" >> "${B}/.config"
			cat $i >> "${B}/.config"
		done
	fi
}
